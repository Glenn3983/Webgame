<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <title>Nebula Games ‚Äì C·ª≠a h√†ng game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    /* ===== Layout s·ª≠a l·ªói ===== */
    .main-container {
      display: grid;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 20px;
      margin: 40px auto;
      padding: 0 20px;
      width: 100vw !important;
      max-width: none !important;
    }

    .filter-section {
      flex: 0 0 260px;
      background: rgba(20, 25, 35, 0.8);
      border: 1px solid #00bcd4;
      border-radius: 8px;
      padding: 20px;
      color: #fff;
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .filter-section h3 {
      margin-bottom: 10px;
      color: #00e5ff;
    }

    .filter-section h4 {
      margin-top: 15px;
      margin-bottom: 5px;
      color: #99e6ff;
    }

    .filter-section label {
      display: block;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .filter-section button {
      margin-top: 10px;
      padding: 8px 15px;
      background: linear-gradient(90deg, #00e5ff, #5a62ff);
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
      transition: 0.2s;
    }

    .filter-section button:hover {
      transform: scale(1.05);
      background: linear-gradient(90deg, #5a62ff, #00e5ff);
    }

    .game-area {
      flex: 1;
      color: #fff;
      background: rgba(10, 15, 25, 0.8);
      border-radius: 8px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .chip {
      background: transparent;
      border: 1px solid #00bcd4;
      border-radius: 20px;
      color: #00bcd4;
      padding: 6px 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .chip.active,
    .chip:hover {
      background: #00bcd4;
      color: #000;
    }
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="header">
    <div class="logo">üåå <span>Nebula</span> Games</div>
    <form class="searchbar" id="search-form">
      <input type="text" id="search-input" placeholder="T√¨m game..." />
      <button type="submit">T√¨m</button>
    </form>
    <nav class="nav">
      <a href="#" class="active">C·ª≠a h√†ng</a>
      <a href="favourite.html">Y√™u th√≠ch</a>
      <a href="#">Gi·ªè h√†ng (0)</a>
      <a href="auth.html" id="login-link">ƒêƒÉng nh·∫≠p</a>
      <div id="user-menu"></div>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-text">
      <h1>Kh√°m ph√° game hot tu·∫ßn n√†y</h1>
      <p>∆Øu ƒë√£i ƒë·∫øn 70% ‚Äì N·∫°p nƒÉng l∆∞·ª£ng cho th∆∞ vi·ªán c·ªßa b·∫°n.</p>
      <button class="btn-primary">Xem khuy·∫øn m√£i</button>
    </div>
  </section>

  <!-- B·∫¢NG ƒêI·ªÄU KHI·ªÇN ADMIN -->
  <section id="adminSection" class="admin-panel" style="display: none;">
    <h2>üéÆ B·∫£ng ƒëi·ªÅu khi·ªÉn Admin</h2>

    <!-- Form th√™m game -->
    <form id="addGameForm" class="admin-form">
      <div class="form-row">
        <input type="text" id="gameName" placeholder="T√™n game" required>
        <input type="text" id="gameStudio" placeholder="Nh√† ph√°t h√†nh / Studio" required>
        <input type="text" id="gameGenre" placeholder="Th·ªÉ lo·∫°i (Action, RPG...)" required>
      </div>
      <div class="form-row">
        <input type="number" id="gamePrice" placeholder="Gi√° (‚Ç´)" required>
        <input type="number" id="gameDiscount" placeholder="Gi·∫£m gi√° (%)">
        <input type="text" id="gameImage" placeholder="Link ·∫£nh b√¨a (URL)">
      </div>
      <button type="submit" class="add-btn">+ Th√™m / C·∫≠p nh·∫≠t Game</button>
    </form>

    <!-- B·∫£ng danh s√°ch game -->
    <div class="admin-table-wrapper">
      <table id="adminGameList" class="admin-table">
        <thead>
          <tr>
            <th>T√™n</th>
            <th>Studio</th>
            <th>Gi√°</th>
            <th>Gi·∫£m</th>
            <th>Th·ªÉ lo·∫°i</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
          <!-- S·∫Ω ƒë∆∞·ª£c th√™m t·ª± ƒë·ªông b·∫±ng JS -->
        </tbody>
      </table>
    </div>
  </section>


  <!-- MAIN -->
  <div class="main-container">
    <!-- B·ªô l·ªçc -->
    <div class="filter-section">
      <h3>B·ªô l·ªçc</h3>
      <div>
        <h4>Th·ªÉ lo·∫°i</h4>
        <label><input type="checkbox" /> H√†nh ƒë·ªông</label>
        <label><input type="checkbox" /> Phi√™u l∆∞u</label>
        <label><input type="checkbox" /> Sinh t·ªìn</label>
        <label><input type="checkbox" /> Indie</label>
        <label><input type="checkbox" /> Chi·∫øn thu·∫≠t</label>
      </div>
      <div>
        <h4>N·ªÅn t·∫£ng</h4>
        <label><input type="checkbox" /> Windows</label>
        <label><input type="checkbox" /> macOS</label>
        <label><input type="checkbox" /> Steam Deck</label>
      </div>
      <div>
        <h4>Gi√°</h4>
        <label><input type="radio" name="price" /> T·∫•t c·∫£</label>
        <label><input type="radio" name="price" /> D∆∞·ªõi 200K</label>
        <label><input type="radio" name="price" /> 200K‚Äì500K</label>
        <label><input type="radio" name="price" /> Tr√™n 500K</label>
      </div>
      <button>√Åp d·ª•ng</button>
    </div>


    <!-- PH·∫¶N HI·ªÇN TH·ªä CHO USER -->
    <div id="userSection" style="display: block;">
      <section id="suggest-section" class="game-area">
        <div class="section-head">
          <h2>ƒê·ªÅ xu·∫•t cho b·∫°n</h2>
          <div class="tabs">
            <button class="chip active">T·∫•t c·∫£</button>
            <button class="chip">Gi·∫£m gi√°</button>
            <button class="chip">M·ªõi ra m·∫Øt</button>
            <button class="chip">B√°n ch·∫°y</button>
          </div>
        </div>
        <div id="gameList" class="game-grid"></div>
      </section>
    </div>
  </div>

  <script type="module">
    import { db } from "../js/firebase-config.js";
    import {
      collection, getDocs, query, where
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const gameList = document.getElementById("gameList");
    const applyBtn = document.querySelector(".filter-section button");

    // T·∫£i t·∫•t c·∫£ game ban ƒë·∫ßu
    async function loadAllGames() {
      const snap = await getDocs(collection(db, "games"));
      renderGames(snap.docs.map(d => ({ id: d.id, ...d.data() })));
    }

    // H√†m render danh s√°ch game
    function renderGames(games) {
      gameList.innerHTML = "";
      if (games.length === 0) {
        gameList.innerHTML = `<p style="color:#aaa;text-align:center;">Kh√¥ng c√≥ game ph√π h·ª£p.</p>`;
        return;
      }

      games.forEach(g => {
        const card = document.createElement("div");
        card.className = "game-card";
        card.innerHTML = `
      <img src="${g.image || "https://via.placeholder.com/300x180"}" alt="${g.name}">
      <h3>${g.name}</h3>
      <p>${(g.price || 0).toLocaleString()} ‚Ç´</p>
    `;
        card.addEventListener("click", () => {
          localStorage.setItem("selectedGameId", g.id);
          window.location.href = "game.html";
        });
        gameList.appendChild(card);
      });
    }

    // X·ª≠ l√Ω khi b·∫•m "√Åp d·ª•ng"
    applyBtn.addEventListener("click", async () => {
      const genreChecks = document.querySelectorAll('.filter-section input[type="checkbox"]');
      const priceRadios = document.querySelectorAll('.filter-section input[name="price"]');

      // L·∫•y danh s√°ch th·ªÉ lo·∫°i ƒë∆∞·ª£c ch·ªçn
      const selectedGenres = Array.from(genreChecks)
        .filter(c => c.checked && ["H√†nh ƒë·ªông", "Phi√™u l∆∞u", "Sinh t·ªìn", "Indie", "Chi·∫øn thu·∫≠t"].includes(c.parentElement.textContent.trim()))
        .map(c => c.parentElement.textContent.trim());

      // L·∫•y l·ª±a ch·ªçn gi√°
      let priceFilter = "T·∫•t c·∫£";
      for (let r of priceRadios) {
        if (r.checked) {
          priceFilter = r.parentElement.textContent.trim();
          break;
        }
      }

      // L·∫•y t·∫•t c·∫£ game t·ª´ Firestore
      const snap = await getDocs(collection(db, "games"));
      let games = snap.docs.map(d => ({ id: d.id, ...d.data() }));

      // √Åp d·ª•ng l·ªçc th·ªÉ lo·∫°i
      if (selectedGenres.length > 0) {
        games = games.filter(g => selectedGenres.includes(g.genre));
      }

      // √Åp d·ª•ng l·ªçc gi√°
      if (priceFilter === "D∆∞·ªõi 200K") {
        games = games.filter(g => g.price <= 200000);
      } else if (priceFilter === "200K‚Äì500K") {
        games = games.filter(g => g.price >= 200000 && g.price <= 500000);
      } else if (priceFilter === "Tr√™n 500K") {
        games = games.filter(g => g.price > 500000);
      }

      renderGames(games);
    });

    // G·ªçi ban ƒë·∫ßu
    loadAllGames();
  </script>


  <!-- FOOTER -->
  <footer class="footer">
    <div>¬© 2025 Nebula Games ‚Ä¢ H·ªó tr·ª£: support@nebula.games</div>
  </footer>

  <!-- Scripts -->
  <script type="module" src="../js/firebase-config.js"></script>
  <script type="module" src="../js/guest.js"></script>
  <script type="module" src="../js/order.js"></script>
</body>

</html>