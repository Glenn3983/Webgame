<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nebula Games â€” YÃªu thÃ­ch</title>
  <link rel="stylesheet" href="./css/style.css" />
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="logo">Nebula<span>Games</span></div>

    <form class="searchbar">
      <input type="text" placeholder="TÃ¬m game yÃªu thÃ­ch..." id="favSearch" />
      <button type="submit">TÃ¬m</button>
    </form>

    <nav class="nav">
      <a href="index.html">Cá»­a hÃ ng</a>
      <a href="favourite.html" class="active">YÃªu thÃ­ch</a>
      <a href="profile.html">Há»“ sÆ¡</a>
    </nav>
    <div class="actions">
        <button id="addToCart">ğŸ›’ ThÃªm vÃ o giá» hÃ ng</button>
        <button id="favBtn">â¤ï¸ LÆ°u vÃ o YÃªu thÃ­ch</button>
    </div>


    <div id="user-menu" class="user-box">
      <img src="https://i.ibb.co/ZYW3VTp/brown-brim.png" alt="Avatar" class="avatar-small" />
      <div id="user-menu"></div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-text">
      <h1>ğŸ® Danh sÃ¡ch YÃªu thÃ­ch</h1>
      <p>Nhá»¯ng tá»±a game báº¡n Ä‘Ã£ Ä‘Ã¡nh dáº¥u lÃ  yÃªu thÃ­ch sáº½ hiá»ƒn thá»‹ táº¡i Ä‘Ã¢y. HÃ£y lÆ°u trá»¯ nhá»¯ng game báº¡n muá»‘n sá»Ÿ há»¯u hoáº·c chÆ¡i láº¡i.</p>
    </div>
  </section>

  <!-- MAIN -->
  <main class="main-container">
    <div class="game-area">
      <div class="section-head">
        <h2>Game cá»§a báº¡n</h2>
      </div>

      <div id="favouriteList" class="game-grid">
        <!-- CÃ¡c game yÃªu thÃ­ch sáº½ Ä‘Æ°á»£c render táº¡i Ä‘Ã¢y -->
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    Â© 2025 Nebula Games â€” YÃªu thÃ­ch
  </footer>

  <script type="module" src="../js/firebase-config.js"></script>
  <script type="module">
    // // Táº£i danh sÃ¡ch game yÃªu thÃ­ch (demo)
    // const favList = document.getElementById("favouriteList");
    // const favGames = JSON.parse(localStorage.getItem("favourites") || "[]");

    // if (favGames.length === 0) {
    //   favList.innerHTML = `<p style="text-align:center;color:#a5b4cf;">Báº¡n chÆ°a thÃªm game nÃ o vÃ o danh sÃ¡ch yÃªu thÃ­ch.</p>`;
    // } else {
    //   favGames.forEach(g => {
    //     const card = document.createElement("div");
    //     const id = docSnap.id;
    //     card.className = "game-card";
    //     card.innerHTML = `
    //       <img src="${g.image}" alt="${g.name}">
    //       <h3>${g.name}</h3>
    //       <p class="meta">${(g.price || 0).toLocaleString()} â‚«</p>
    //     `;
    //     card.addEventListener("click", () => {
    //       localStorage.setItem("selectedGameId", id);
    //       window.location.href = "game.html";
    //   });
    //     favList.appendChild(card);
    //   });
    // }

    // // TÃ¬m kiáº¿m trong danh sÃ¡ch yÃªu thÃ­ch
    // document.querySelector(".searchbar").addEventListener("submit", (e) => {
    //   e.preventDefault();
    //   const keyword = document.getElementById("favSearch").value.trim().toLowerCase();
    //   const cards = favList.querySelectorAll(".game-card");
    //   let count = 0;
    //   cards.forEach(card => {
    //     const name = card.querySelector("h3").textContent.toLowerCase();
    //     card.style.display = name.includes(keyword) ? "" : "none";
    //     if (name.includes(keyword)) count++;
    //   });
    //   if (count === 0)
    //     favList.innerHTML = `<p style="text-align:center;color:#a5b4cf;">KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p.</p>`;
    // });
    // Import Firebase modules
  import { auth, db } from "../js/firebase-config.js";
  import {
    collection,
    getDocs,
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

  const favList = document.getElementById("favouriteList");

  // ====== ÄÄƒng nháº­p vÃ  táº£i danh sÃ¡ch YÃªu thÃ­ch tá»« Firestore ======
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      favList.innerHTML = `<p style="text-align:center;color:#a5b4cf;">Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ xem danh sÃ¡ch yÃªu thÃ­ch.</p>`;
      return;
    }

    try {
      // Láº¥y danh sÃ¡ch yÃªu thÃ­ch cá»§a user (users/{uid}/favourites)
      const favSnap = await getDocs(collection(db, "users", user.uid, "favourites"));
      if (favSnap.empty) {
        favList.innerHTML = `<p style="text-align:center;color:#a5b4cf;">Báº¡n chÆ°a thÃªm game nÃ o vÃ o danh sÃ¡ch yÃªu thÃ­ch.</p>`;
        return;
      }

      // Duyá»‡t tá»«ng game yÃªu thÃ­ch, láº¥y thÃ´ng tin chi tiáº¿t tá»« collection "games"
      favList.innerHTML = "";
      for (const docSnap of favSnap.docs) {
        const favData = docSnap.data(); // chá»©a id game
        const gameId = favData.id;

        // Láº¥y thÃ´ng tin chi tiáº¿t cá»§a game tá»« Firestore
        const gameRef = doc(db, "games", gameId);
        const gameSnap = await getDoc(gameRef);

        if (!gameSnap.exists()) continue;
        const g = gameSnap.data();

        // Táº¡o card hiá»ƒn thá»‹
        const card = document.createElement("div");
        card.className = "game-card";
        card.innerHTML = `
          <img src="${g.image || "https://via.placeholder.com/300x180"}" alt="${g.name}">
          <h3>${g.name}</h3>
          <p class="meta">${(g.price || 0).toLocaleString()} â‚«</p>
        `;

        // Khi click vÃ o card â†’ lÆ°u ID vÃ  chuyá»ƒn sang game.html
        card.addEventListener("click", () => {
          localStorage.setItem("selectedGameId", gameId);
          window.location.href = "game.html";
        });

        favList.appendChild(card);
      }
    } catch (error) {
      console.error("Lá»—i táº£i danh sÃ¡ch yÃªu thÃ­ch:", error);
      favList.innerHTML = `<p style="text-align:center;color:#ff6b6b;">KhÃ´ng thá»ƒ táº£i danh sÃ¡ch yÃªu thÃ­ch. (${error.message})</p>`;
    }
  });

  // ====== TÃ¬m kiáº¿m trong danh sÃ¡ch yÃªu thÃ­ch ======
  document.querySelector(".searchbar").addEventListener("submit", (e) => {
    e.preventDefault();
    const keyword = document.getElementById("favSearch").value.trim().toLowerCase();
    const cards = favList.querySelectorAll(".game-card");
    let count = 0;
    cards.forEach(card => {
      const name = card.querySelector("h3").textContent.toLowerCase();
      card.style.display = name.includes(keyword) ? "" : "none";
      if (name.includes(keyword)) count++;
    });
    if (count === 0)
      favList.innerHTML = `<p style="text-align:center;color:#a5b4cf;">KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p.</p>`;
  });
  </script>

    
    <!-- <script type="module" src="../js/guest.js"></script> -->
    <!-- <script type="module" src="../js/order.js"></script> -->
</body>
</html>
